"use strict";var Aegis,AegisAjax,AegisUI,a_button_upload,a_current_col,a_current_row,a_current_sidebar,a_current_widget,a_media;a_current_row=void 0,a_current_col=void 0,a_current_sidebar=void 0,a_current_widget=void 0,a_button_upload=void 0,a_media=void 0,jQuery(document).ready(function(){AegisUI.initColorPicker(),AegisUI.initMediaCenter(),Aegis.initSortableWidget(),Aegis.initSortableColumn(),Aegis.initSortableRow(),Aegis.initDialogGrid(),Aegis.initDialogWidgets(),Aegis.initDialogSingleWidget(),Aegis.initDialogRowCustomize(),Aegis.initDialogColCustomize(),Aegis.initDialogGridAction(),Aegis.initDialogSingleWidgetAction(),Aegis.initGridAction(),Aegis.initRowAction(),Aegis.initColumnAction(),Aegis.initWidgetAction(),Aegis.initTabs()}),jQuery(window).load(function(){AegisUI.openHelp()}),jQuery(document).ajaxSuccess(function(){AegisUI.initColorPicker(),AegisUI.initMediaCenter()}),Aegis={initSortableRow:function(){jQuery(".a_row_wrap").sortable({handle:".a_row_hanle",start:function(e,a){a.placeholder.height("48px"),a.placeholder.width("100px")},helper:function(){return'<span class="a_block_helper">'+aegis_json.i18n.row+"</span>"}}).disableSelection()},initSortableColumn:function(){jQuery(".a_column_wrap").sortable({containment:"parent",connectWith:".a_column_wrap",handle:".a_column_hanle",start:function(e,a){a.placeholder.height("48px"),a.placeholder.width("100px")},helper:function(){return'<span class="a_block_helper">'+aegis_json.i18n.column+"</span>"}}).disableSelection()},initSortableWidget:function(){jQuery(".a_block_wrap").sortable({connectWith:".a_block_wrap",handle:".a_block_hanle",start:function(e,a){a.placeholder.height("48px"),a.placeholder.width("100px")},helper:function(){return'<span class="a_block_helper">'+aegis_json.i18n.block+"</span>"}}).disableSelection()},initDialogGrid:function(){jQuery("#a_modal_grid").dialog({title:aegis_json.i18n.layouts,dialogClass:"a_fixed_dialog",width:900,height:500,modal:!0,autoOpen:!1,create:function(){var e;e=jQuery(this).dialog("widget"),jQuery(".ui-dialog-titlebar-close",e).html('<i class="ti ti-close"></i>').addClass("a_dialog_close")}})},initDialogWidgets:function(){jQuery("#a_modal_widgets").dialog({title:aegis_json.i18n.elements,dialogClass:"a_fixed_dialog",width:900,height:500,modal:!0,autoOpen:!1,create:function(){var e;e=jQuery(this).dialog("widget"),jQuery(".ui-dialog-titlebar-close",e).html('<i class="ti ti-close"></i>').addClass("a_dialog_close")}})},initDialogRowCustomize:function(){jQuery("#a_modal_row_customize").dialog({title:aegis_json.i18n.row_customize,dialogClass:"a_fixed_dialog",width:900,height:500,modal:!0,autoOpen:!1,create:function(){var e;e=jQuery(this).dialog("widget"),jQuery(".ui-dialog-titlebar-close",e).html('<i class="ti ti-close"></i>').addClass("a_dialog_close")},buttons:[{text:"Save & Exit","class":"a_button_save_and_exit button button-secondary",click:function(){jQuery("#a_modal_row_customize").submit(),jQuery("#a_modal_row_customize").dialog("close")}},{text:"Save","class":"a_button_save button button-primary",click:function(){jQuery("#a_modal_row_customize").submit()}}]})},initDialogColCustomize:function(){jQuery("#a_modal_col_customize").dialog({title:aegis_json.i18n.col_customize,dialogClass:"a_fixed_dialog",width:900,height:500,modal:!0,autoOpen:!1,create:function(){var e;e=jQuery(this).dialog("widget"),jQuery(".ui-dialog-titlebar-close",e).html('<i class="ti ti-close"></i>').addClass("a_dialog_close")},buttons:[{text:aegis_json.i18n.save_and_exit,"class":"a_button_save_and_exit button button-secondary",click:function(){jQuery("#a_modal_col_customize").submit(),jQuery("#a_modal_col_customize").dialog("close")}},{text:aegis_json.i18n.save,"class":"a_button_save button button-primary",click:function(){jQuery("#a_modal_col_customize").submit()}}]})},initDialogSingleWidget:function(){jQuery("#a_modal_single_widget").dialog({title:"",dialogClass:"a_fixed_dialog",width:900,height:500,modal:!0,autoOpen:!1,create:function(){var e;e=jQuery(this).dialog("widget"),jQuery(".ui-dialog-titlebar-close",e).html('<i class="ti ti-close"></i>').addClass("a_dialog_close")},buttons:[{text:"Save & Exit","class":"a_button_save_and_exit button button-secondary",click:function(){jQuery("#a_modal_single_widget").submit(),jQuery("#a_modal_single_widget").dialog("close"),jQuery("#a_modal_single_widget").dialog("option","title","")}},{text:"Save","class":"a_button_save button button-primary",click:function(){jQuery("#a_modal_single_widget").submit()}}]})},initDialogGridAction:function(){jQuery("#a_modal_grid").on("click",".a_row_mockup",function(){var e,a,i,t,o,n,s,l,_;if(void 0!==a_current_row&&(l=parseInt(a_current_row.attr("data-index")),n=parseInt(jQuery(this).attr("data-index")),a_current_row.attr("data-index",n),jQuery("#a_modal_grid").dialog("close"),l!==n)){if(s=aegis_json.layouts[l],o=aegis_json.layouts[n],i=a_current_row.find(".a_column_wrap"),parseInt(s.length)<parseInt(o.length))for(t=0;t<o.length-s.length;)i.append(Aegis.getColumnTemplate()),t++;else parseInt(s.length)>parseInt(o.length)&&(e=i.find(".a_block"),_={},e.length&&(_=e.clone()),i.html(""),jQuery.each(o,function(){i.append(Aegis.getColumnTemplate())}),_.length&&_.appendTo(i.find(".a_column_item_outer .a_block_wrap").first()));for(a=a_current_row.find(".a_column_item_outer"),t=0;t<o.length;)a.eq(t).attr("class","").addClass("a_column_item_outer").addClass("a_col_"+o[t]),a.eq(t).attr("data-index",o[t]),t++;Aegis.initSortableWidget(),Aegis.initSortableColumn(),Aegis.initSortableRow()}})},initDialogSingleWidgetAction:function(){jQuery("#a_modal_widgets").on("click",".a_item",function(){var e,a,i;jQuery("#a_modal_widgets").dialog("close"),e=jQuery(this).find("input[name=a_widget_class_name]").val(),i=jQuery(this).find("input[name=a_widget_title]").val(),a=Aegis.getRandomId(aegis_json.key.widget+"_"),AegisAjax.getWidgetForm(a,i,e)})},initGridAction:function(){jQuery("#aegis_metabox").on("click",".a_save_all",function(e){e.preventDefault(),AegisAjax.saveAll()})},initRowAction:function(){jQuery("#aegis_metabox").on("click",".a_row_style",function(e){e.preventDefault(),a_current_row=jQuery(this).parents(".a_grid_item"),jQuery("#a_modal_grid").dialog("open")}),jQuery("#aegis_metabox").on("click",".a_add_row",function(e){e.preventDefault(),jQuery("#aegis_metabox .a_row_wrap").append(Aegis.getRowTemplate()),Aegis.initSortableWidget(),Aegis.initSortableColumn(),Aegis.initSortableRow()}),jQuery("#aegis_metabox").on("click",".a_row_close",function(e){var a;e.preventDefault(),a=confirm("Are you sure to remove this row?"),!0===a&&(jQuery(this).parents(".a_grid_item").remove(),AegisAjax.saveAll())}),jQuery("#aegis_metabox").on("click",".a_row_customize",function(e){var a;e.preventDefault(),a_current_row=jQuery(this).parents(".a_grid_item"),a=a_current_row.attr("id"),AegisAjax.getRowCustomizeForm(a)})},initColumnAction:function(){jQuery("#aegis_metabox").on("click",".a_column_add_widget",function(e){e.preventDefault(),a_current_sidebar=jQuery(this).parents(".a_column_item").find(".a_block_wrap"),jQuery("#a_modal_widgets").dialog("open")}),jQuery("#aegis_metabox").on("click",".a_col_customize",function(e){var a;e.preventDefault(),a_current_col=jQuery(this).parents(".a_column_item_outer"),a=a_current_col.attr("id"),AegisAjax.getColCustomizeForm(a)})},initWidgetAction:function(){jQuery("#aegis_metabox").on("click",".a_block_close",function(e){var a;e.preventDefault(),a=confirm("Are you sure to remove this widget?"),!0===a&&AegisAjax.removeWidget(jQuery(this))}),jQuery("#aegis_metabox").on("click",".a_block_edit",function(e){var a,i,t,o;e.preventDefault(),a=jQuery(this).parents(".a_block"),t=a.attr("id"),o=jQuery.trim(a.find(".a_body").html()),i="",a_current_sidebar=a.parents(".a_block_wrap"),a_current_widget=a,AegisAjax.getWidgetForm(t,o,i)})},getRowTemplate:function(){var e;return e='<div id="'+Aegis.getRandomId(aegis_json.key.row+"_")+'" class="a_grid_item" data-index="0">',e+='<div class="a_header a_clearfix">',e+='<span class="a_action a_hanle a_row_hanle a_pull_left a_tooltip" title="'+aegis_json.i18n.drag_row_to_reorder+'"><i class="ti-split-v"></i></span>',e+='<span class="a_action a_row_style a_pull_left a_tooltip" title="'+aegis_json.i18n.split_row_to_multi_columns+'"><i class="ti-layout-column3"></i></span>',e+='<span class="a_action a_row_customize a_pull_left a_tooltip" title="'+aegis_json.i18n.edit_this_row+'"><i class="ti-pencil"></i></span>',e+='<span class="a_action a_close a_row_close a_pull_right a_tooltip" title="'+aegis_json.i18n.delete_this_row+'"><i class="ti-trash"></i></span>',e+="</div>",e+='<div class="a_body a_clearfix">',e+='<div class="a_column_wrap a_row a_clearfix">',e+=Aegis.getColumnTemplate(),e+="</div>",e+="</div>",e+="</div>"},getColumnTemplate:function(){var e;return e='<div id="'+Aegis.getRandomId(aegis_json.key.col+"_")+'" class="a_column_item_outer a_col_12" data-index="12">',e+='<div class="a_column_item">',e+='<div class="a_header a_clearfix">',e+='<span class="a_action a_hanle a_column_hanle a_pull_left a_tooltip" title="'+aegis_json.i18n.drag_column_to_reorder+'"><i class="ti-split-v"></i></span>',e+='<span class="a_action a_column_add_widget a_pull_left a_tooltip" title="'+aegis_json.i18n.insert_new_widget_to_this_column+'"><i class="ti-package"></i></span>',e+='<span class="a_action a_col_customize a_pull_left a_tooltip" title="'+aegis_json.i18n.edit_this_column+'"><i class="ti-pencil"></i></span>',e+="</div>",e+='<div class="a_block_wrap a_body a_clearfix">',e+="</div>",e+="</div>",e+="</div>"},getRandomId:function(e){return e+Math.random().toString(36).substr(2)},initTabs:function(){var e;e=jQuery(".a_tabs"),e.length&&e.on("click",".a_tab_item",function(e){var a;e.preventDefault(),jQuery(this).hasClass("a_active")||(jQuery(this).parent().find(".a_tab_item").removeClass("a_active"),jQuery(this).addClass("a_active"),a=jQuery(this).find("span").attr("data-tab-id"),jQuery(this).parents(".a_tabs").find(".a_tab_content.a_active").removeClass("a_active").addClass("a_hide"),jQuery(a).removeClass("a_hide").addClass("a_active"))})}},AegisUI={alert:function(e){jQuery.amaran({message:e,position:"bottom right",inEffect:"slideRight"})},initColorPicker:function(){var e;e=jQuery("input.a_ui_color"),e.length&&e.wpColorPicker()},initMediaCenter:function(){jQuery(".a_ui_image").on("click",".a_image_add",function(e){return e.preventDefault(),a_button_upload=jQuery(this),a_media?(a_media.open(),void 0):(a_media=wp.media.frames.a_media=wp.media({title:aegis_json.i18n.media_center,button:{text:aegis_json.i18n.use},library:{type:"image"},multiple:!1}),a_media.on("select",function(){var e;e=a_media.state().get("selection").first().toJSON(),a_button_upload.parents(".a_ui_image").find(".a_image_url").val(e.url)}),a_media.open(),void 0)}),jQuery(".a_ui_image").on("click",".a_image_remove",function(e){e.preventDefault(),jQuery(this).parents(".a_ui_image").find(".a_image_url").val("")})},openHelp:function(){jQuery("body").on("click",".a_desc_handler",function(e){var a;e.preventDefault(),a=jQuery(this).next(),a.hasClass("a_hide")?a.removeClass("a_hide").addClass("a_active"):a.removeClass("a_active").addClass("a_hide")})}},AegisAjax={saveAll:function(){var e,a;e={rows:[]},a=jQuery(".a_grid_item"),a.length&&a.each(function(a,i){var t,o,n;o=jQuery(i),n={id:o.attr("id"),index:o.attr("data-index"),cols:[]},t=o.find(".a_column_item_outer"),t.length&&t.each(function(e,a){var i,t,o;t=jQuery(a),i={id:t.attr("id"),index:t.attr("data-index"),widgets:[]},o=t.find(".a_block"),o.length&&o.each(function(e,a){var t,o;t=jQuery(a),o={id:t.attr("id"),name:jQuery.trim(t.find(".a_body").html())},i.widgets.push(o)}),n.cols.push(i)}),e.rows.push(n)}),jQuery.ajax({url:aegis_json.ajax,dataType:"html",type:"POST",async:!0,data:{data:e,action:"aegis_save_all",security:jQuery("#aegis_save_all_security").val(),post_id:parseInt(jQuery("#post_ID").val())},success:function(e){return AegisUI.alert(e)}})},getRowCustomizeForm:function(e){a_current_row&&jQuery.ajax({url:aegis_json.ajax,dataType:"html",type:"POST",async:!0,data:{action:"aegis_get_row_customize_form",security:jQuery("#aegis_get_row_customize_form_security").val(),post_id:parseInt(jQuery("#post_ID").val()),row_id:e},success:function(a){jQuery("#a_modal_row_customize .a_row_customize_form").html(a),jQuery("#a_modal_row_customize input[name=a_row_id]").val(e),jQuery("#a_modal_row_customize").dialog("open")}})},saveRowCustomize:function(e,a){e.preventDefault(),a.ajaxSubmit({success:function(e){e&&AegisUI.alert(e)}})},getColCustomizeForm:function(e){a_current_col&&jQuery.ajax({url:aegis_json.ajax,dataType:"html",type:"POST",async:!0,data:{action:"aegis_get_col_customize_form",security:jQuery("#aegis_get_col_customize_form_security").val(),post_id:parseInt(jQuery("#post_ID").val()),col_id:e},success:function(a){jQuery("#a_modal_col_customize .a_col_customize_form").html(a),jQuery("#a_modal_col_customize input[name=a_col_id]").val(e),jQuery("#a_modal_col_customize").dialog("open")}})},saveColCustomize:function(e,a){e.preventDefault(),a.ajaxSubmit({success:function(e){e&&AegisUI.alert(e)}})},getWidgetForm:function(e,a,i){a_current_sidebar&&jQuery.ajax({url:aegis_json.ajax,dataType:"html",type:"POST",async:!0,data:{widget_class_name:i,widget_title:a,widget_id:e,action:"aegis_get_widget_form",security:jQuery("#aegis_get_widget_form_security").val(),post_id:parseInt(jQuery("#post_ID").val())},success:function(t){jQuery("#a_modal_single_widget .a_widget_form").html(t),jQuery("#a_modal_single_widget input[name=a_widget_class_name]").val(i),jQuery("#a_modal_single_widget input[name=a_widget_title]").val(a),jQuery("#a_modal_single_widget input[name=a_widget_id]").val(e),jQuery("#a_modal_single_widget").dialog("option","title",a),jQuery("#a_modal_single_widget").dialog("open")}})},saveWidget:function(e,a){e.preventDefault(),a.ajaxSubmit({dataType:"json",success:function(e){1===e.is_first?(a_current_sidebar.append(e.html),Aegis.initSortableWidget(),Aegis.initSortableColumn(),Aegis.initSortableRow()):(a_current_widget.find(".a_body").html(e.html),a_current_widget=void 0),AegisAjax.saveAll()}})},removeWidget:function(e){var a;a=e.parents(".a_block"),jQuery.ajax({url:aegis_json.ajax,dataType:"html",type:"POST",async:!0,data:{widget_id:a.attr("id"),action:"aegis_remove_widget",security:jQuery("#aegis_remove_widget_security").val(),post_id:parseInt(jQuery("#post_ID").val())},success:function(){a.remove(),AegisAjax.saveAll()}})}};